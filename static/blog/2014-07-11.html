<!doctype html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="Content-Style-Type" content="text/css" />
<meta name="generator" content="pandoc" />

<link rel="stylesheet" href="/static/css/bootstrap.css" type="text/css"/>
<link rel="stylesheet" href="/static/css/blog.css" type="text/css"/>

<title>composer会成为主流么？</title>
<meta name="keywords" content="composer">
<meta name="description" content="composer">
<script type="text/javascript">
var _speedMark = new Date();
</script>
</head>

<body>
<div class="navbar navbar-fixed-top">
  <div class="container">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
      </div>
        <div class="navbar-collapse collapse">
        <ul class="nav navbar-nav ml90">
          <li data-slide="1" class="col-xs-4"><a href="/"  id="menu-link-1"><span class="glyphicon glyphicon-home"></span>首页</a></li>
          <li data-slide="2" class="col-xs-4 active"><a href="/blog/" id="menu-link-2"><span class="glyphicon glyphicon-book"></span>博客</a></li>
          <li data-slide="3" class="col-xs-4"><a href="/team/" id="menu-link-3" target="_blank"><span class="glyphicon glyphicon-user"></span>团队</a></li>
        </ul>
      <div class="row">
        <div class="col-xs-4 active-menu"></div>
      </div>
          
      </div>
    </div>
</div>
<div class="content-title"><h1 class="title glyphicon glyphicon-leaf">composer会成为主流么？<span class="view glyphicon glyphicon-eye-open"></span><span class="time glyphicon glyphicon-time"></span></h1></div>

<div class="content">
	<!---title:composer会成为主流么？-->
<!---keywords:composer-->

<p>注意到composer是在最近学习一些github里面的项目时，发现很多都有composer.json，原来这货是为了composer包依赖管理工作而活的。其实它在前几年就出现了，只是那个时候PHP版本5.3以后的版本都慢慢兴起来，也就是命名空间才被引用。那，这货到底能干嘛呢？简单来说就是为你引入一个别人写好的功能包，并且为你做好自动加载，你只需要用php标准命名空间来初始化实例就行。可以看下中文的<a href="http://composer.golaravel.com/">翻译介绍</a>。</p>
<p>要理解好composer需要了解其它一些辅助工具，逐一来介绍下。预装好php环境，composer工具，这些得必须弄好的吧？</p>
<h2 id="composer-安装">1. composer 安装</h2>
<pre><code>curl -sS http://getcomposer.org/installer| php -- --install-dir=/usr/local/php/bin
cp /usr/local/php/bin/composer.phar /usr/bin/
composer about # 验证</code></pre>
<h2 id="composer.json">2. composer.json</h2>
<p>composer.json声明了包依赖以及声明元素标签，关键的就是<code>require</code></p>
<pre><code>{
    &quot;require&quot;: {
        &quot;php&quot;: &quot;&gt;=5.3&quot;,
        &quot;huamanshu/xorm&quot;: &quot;dev-master&quot;
    }
}</code></pre>
<p>如你所见，require的对象将会映射包的名称（huamanshu/xorm）和包的版本是dev-master。那，composer会拿huamanshu/xorm去哪得到相应的包呢？</p>
<h2 id="packagist">3. packagist</h2>
<p>依赖包名<code>huamanshu/xorm</code>会到https://packagist.org去获取包。如果你是包的开发者，那你需要先注册一个账号，github亦如此，再提交你的包名到列表里去。</p>
<p>而packagist不是实际源码存储的地方，它只是自动同步github的项目https://github.com/meolu/xorm.git</p>
<h2 id="github">4. github</h2>
<p>开发者创建自己的项目，然后在setting里面配置hooks，填写packagist提供的name、token就可以在提交的时候，自动同步到packagist。</p>
<p>其中项目中composer.json跟上面用来引入包的composer.json不太一样，主要在<code>autoload</code>，我范例使用的是PSR-4。</p>
<pre><code>{
    &quot;name&quot;: &quot;huamanshu/xorm&quot;,
    &quot;type&quot;: &quot;library&quot;,
    &quot;require&quot;: {
        &quot;php&quot;: &quot;&gt;=5.3.0&quot;
    },
    &quot;autoload&quot;: {
        &quot;psr-4&quot;: {
            &quot;xorm\\&quot;:&quot;src/xorm&quot;
        }
    }
}</code></pre>
<h2 id="php规范标准">5. PHP规范标准</h2>
<p>最新的规范是有5个，<a href="http://www.php-fig.org/">简称PSR</a>。</p>
<ul>
<li>PSR-0 自动加载</li>
<li>PSR-1 基本代码规范</li>
<li>PSR-2 代码样式</li>
<li>PSR-3 日志接口</li>
<li>PSR-4 自动加载增强版</li>
</ul>
<p>现在composer里一般在使用PSR-0、PSR-4，后者是在13年底发布的，但相对前者简洁了很多，看个例子。</p>
<p>Composer使用PSR-0风格</p>
<pre><code>vendor/
    vendor_name/
        package_name/
            src/
                Vendor_Name/
                    Package_Name/
                        ClassName.php       # Vendor_Name\Package_Name\ClassName
            tests/
                Vendor_Name/
                    Package_Name/
                        ClassNameTest.php   # Vendor_Name\Package_Name\ClassName</code></pre>
<p>Composer使用PSR-4风格</p>
<pre><code>vendor/
    vendor_name/
        package_name/
            src/
                ClassName.php       # Vendor_Name\Package_Name\ClassName
            tests/
                ClassNameTest.php   # Vendor_Name\Package_Name\ClassNameTest</code></pre>
<h2 id="引入包">6. 引入包</h2>
<p>在开始新建的composer.json初始化下<code>composer install</code>就会生成以下目录。</p>
<pre><code>├── composer.json  
├── composer.lock  
├── test.php 
└── vendor  
    ├── autoload.php  
    ├── composer  
    │   ├── autoload_classmap.php  
    │   ├── autoload_namespaces.php  
    │   ├── autoload_psr4.php  
    │   ├── autoload_real.php  
    │   ├── ClassLoader.php  
    │   └── installed.json  
    └── huamanshu  
        └── xorm  
            ├── composer.json  
            ├── README.md  
            └── src  
                └── xorm  
                    └── Go.php  </code></pre>
<p>github项目xorm会加载到vendor下，并且生成自动加载文件autoload.php。这过程有点类似thrift，根据一个.thrift文件gen各种语言的接口。</p>
<h2 id="使用包">7. 使用包</h2>
<pre><code>&lt;?php
require __DIR__ . &#39;/vendor/autoload.php&#39;;
$go = new xorm\Go();
$go-&gt;where(); # class Go&#39;s function where</code></pre>
<h2 id="工程意义">8. 工程意义</h2>
<p>除了packagist包，composer 也有平台的包，这些包是并不是由 comoposer 安装，它们是安装在操作系统上的东西，composer 将它们作为虚拟的包，以方便管理。它们包括：PHP 本身，PHP 的扩展，还有一些系统中的库。<code>composer show --platform</code>即可看到。</p>
<p>composer提供这样一个包依赖管理方式对于PHP这样一个社区兴盛的语言，会类似python、java一样，有大量开发者提供了功能包，需要一个方便的机制来调用，版本更新切换、层级嵌套神马的。文件拷贝、代码复制粘贴的时代早已落伍，或许composer很快能一统江湖。无论是想做统计、日志、ORM等等，composer仓库里找找，几分钟后，轮子都已经装备完毕，就等点火启动，爽不？</p>
</div>

<hr class="blog-hr">

<div class="container blog-container prev-next-box">
  <ul class="pager">
    <li class="previous"><a href="javascript:void(0);" id="prev">&larr; Older</a></li>
    <li class="next"><a href="javascript:void(0);" id="next">Newer &rarr;</a></li>
  </ul>
</div>

<div class="content" data-slide="1">
	<div class="blog-container">
		<div id="home-row-1" class="clearfix">
			<div id="comments"></div>
		</div>
	</div>
</div>

<div class="container blog-container comment-box">
		<form class="form-horizontal" role="form">
	  <div class="form-group">
	    <div class="col-sm-3">
	      <input type="text" class="form-control js-name" placeholder="名字不重要">
	    </div>
	  </div>
	  <div class="form-group">
	    <div class="col-sm-10">
	      <textarea class="form-control inputComment js-comment" placeholder="深有感触，写点我的想法"> </textarea>
	    </div>
	  </div>
	  <div class="form-group">
	    <div class="col-sm-10">
	      <button type="submit" class="btn btn-default js-submit">发表评论</button>
	    </div>
	  </div>
	</form>
</div>
<!-- <div id="blog-footer"><a href="http://e.weibo.com/csdnsupport/profile" target="_blank" class="weibo">微博</a> | <a href="http://e.weibo.com/csdnsupport/profile" target="_blank" class="glyphicon glyphicon-envelope email-footer">wushuiyong@huamanshu.com</a> </div> -->
<div id="blog-footer">©2014 huamanshu. All rights reserved</div><div class="hide" style="display:none"><script type="text/javascript" src="http://hm.baidu.com/h.js?fb1a70589b6397ff055728e0196175d5"></script></div>
<script src="/static/js/jquery-1.10.2.min.js" type="text/javascript"></script>
<script src="/static/js/jquery.easing.1.3.js" type="text/javascript"></script>
<script src="/static/js/script.js" type="text/javascript"></script>
<script>
$(document).ready(function(e) {
  var lis = $('.nav > li');
  menu_focus( lis[1], 1 );
  
  var sprintf = function() {
      var arg = arguments,
          str = arg[0] || '',
          i, n;
      for (i = 1, n = arg.length; i < n; i++) {
          str = str.replace(/%s/, arg[i]);
      }
      return str;
  }

  // 初始化评论
  var initComment = function() {
    $.ajax({
      'type' : 'GET',
      'url'  : '/home/blog/getComment/',
      'data' : 'id=' + encodeURIComponent(window.location.href),
      'success' : function(data) {
          var tpl = '';
          for (key in data.comments) {
              var c = data.comments[key];
              tpl += sprintf("<blockquote><p><em>%s</em>%s</p></blockquote>", c.name, c.comment);
          }
          $('#comments').html(tpl).show();
      }
    })
  }
  initComment();

  // 初始化浏览次数
  var initViewCount = function() {
    $.ajax({
      'type' : 'GET',
      'url'  : '/home/blog/viewCount/',
      'data' : 'id=' + encodeURIComponent(window.location.href),
      'success' : function(data) {
          $('.time').text(data.time);
          $('.view').text(data.view);
      }
    });
  }
  initViewCount();

  // 获取上一篇下一篇
  var initNextPrev = function() {
    $.ajax({
      'type' : 'GET',
      'url'  : '/home/blog/getNextPrev/',
      'data' : 'id=' + encodeURIComponent(window.location.href),
      'success' : function(data) {
        var re = /\/index\d.html/
        var nTitle = re.test(data.n.url) ? '下一页' : data.n.title;
        var pTitle = re.test(data.p.url) ? '上一页' : data.p.title;
        data.n ? $('#next').attr('href', data.n.url).html(nTitle + ' &rarr;') : $('#next').hide();
        data.p ? $('#prev').attr('href', data.p.url).html('&larr; ' + pTitle) : $('#prev').hide();
      }
    });
  }
  initNextPrev();

  // 写完点提交或者ctrl+enter
  if (event.ctrlKey && event.keyCode == '13') {
    addComment();
  }
  $('.js-submit').click(function(e) {
    e.preventDefault();
    addComment();
  })

  // 添加评论
  var addComment = function() {
    var name = $('.js-name').val();
    var comment = $('.js-comment').val();

    $.ajax({
      'type' : 'POST',
      'url'  : '/home/blog/addComment/',
      'data' : sprintf('name=%s&comment=%s&id=%s', encodeURIComponent(name), encodeURIComponent(comment), encodeURIComponent(window.location.href)),
      'success' : function(data) {
          initComment();
          $('.js-name').val('');
          $('.js-comment').val('');
      }
    })
  }
});

</script>
<script type="text/javascript" src="http://hm.baidu.com/h.js?fb1a70589b6397ff055728e0196175d5"></script>

</body>
</html>
